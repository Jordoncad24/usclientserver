{"ast":null,"code":"import React,{useEffect,useState}from'react';import{BrowserRouter as Router,Route,Routes,Link}from'react-router-dom';import'./App.css';import RegionPage from'./RegionPage';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const App=()=>{const[data,setData]=useState([]);const[error,setError]=useState(null);useEffect(()=>{const ws=new WebSocket('ws://localhost:8080');ws.onmessage=event=>{try{const receivedData=JSON.parse(event.data);setData(receivedData);setError(null);// Clear any previous errors\n}catch(err){setError('Failed to parse the data received from the server.');console.error('Data parsing error:',err);}};ws.onclose=()=>{console.log('WebSocket connection closed');setError('WebSocket connection closed. Please refresh the page to try reconnecting.');};ws.onerror=()=>{console.log('WebSocket error');setError('An error occurred with the WebSocket connection. Please try again later.');};return()=>{ws.close();};},[]);return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"DevOps Monitoring Dashboard\"}),error?/*#__PURE__*/_jsx(\"p\",{className:\"error-message\",children:error}):data.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"region-links\",children:data.map(regionData=>/*#__PURE__*/_jsx(Link,{to:`/region/${regionData.region}`,className:\"region-button\",children:regionData.region.toUpperCase()},regionData.region))}):/*#__PURE__*/_jsx(\"p\",{children:\"Loading data...\"})]}),/*#__PURE__*/_jsx(Routes,{children:/*#__PURE__*/_jsx(Route,{path:\"/region/:regionId\",element:/*#__PURE__*/_jsx(RegionPage,{data:data})})})]})});};export default App;","map":{"version":3,"names":["React","useEffect","useState","BrowserRouter","Router","Route","Routes","Link","RegionPage","jsx","_jsx","jsxs","_jsxs","App","data","setData","error","setError","ws","WebSocket","onmessage","event","receivedData","JSON","parse","err","console","onclose","log","onerror","close","children","className","length","map","regionData","to","region","toUpperCase","path","element"],"sources":["C:/Users/theco/Documents/websocket-clientserver/websocket-client/src/App.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { BrowserRouter as Router, Route, Routes, Link } from 'react-router-dom';\r\nimport './App.css';\r\nimport RegionPage from './RegionPage';\r\n\r\ninterface RegionData {\r\n  status: string;\r\n  region: string;\r\n  results: {\r\n    services: {\r\n      redis: boolean;\r\n      database: boolean;\r\n    };\r\n    stats: {\r\n      servers_count: number;\r\n      online: number;\r\n      session: number;\r\n      server: {\r\n        active_connections: number;\r\n        wait_time: number;\r\n        workers: [string, {\r\n          wait_time: number;\r\n          workers: number;\r\n          waiting: number;\r\n          idle: number;\r\n          time_to_return: number;\r\n          recently_blocked_keys: [string, number, string][];\r\n          top_keys: [string, number][];\r\n        }][];\r\n        cpu_load: number;\r\n        timers: number;\r\n      };\r\n    };\r\n  };\r\n  lastChecked: string;\r\n}\r\n\r\nconst App: React.FC = () => {\r\n  const [data, setData] = useState<RegionData[]>([]);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const ws = new WebSocket('ws://localhost:8080');\r\n\r\n    ws.onmessage = (event) => {\r\n      try {\r\n        const receivedData: RegionData[] = JSON.parse(event.data);\r\n        setData(receivedData);\r\n        setError(null); // Clear any previous errors\r\n      } catch (err) {\r\n        setError('Failed to parse the data received from the server.');\r\n        console.error('Data parsing error:', err);\r\n      }\r\n    };\r\n\r\n    ws.onclose = () => {\r\n      console.log('WebSocket connection closed');\r\n      setError('WebSocket connection closed. Please refresh the page to try reconnecting.');\r\n    };\r\n\r\n    ws.onerror = () => {\r\n      console.log('WebSocket error');\r\n      setError('An error occurred with the WebSocket connection. Please try again later.');\r\n    };\r\n\r\n    return () => {\r\n      ws.close();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <Router>\r\n      <div className=\"App\">\r\n        <header className=\"App-header\">\r\n          <h1>DevOps Monitoring Dashboard</h1>\r\n          {error ? (\r\n            <p className=\"error-message\">{error}</p>\r\n          ) : data.length > 0 ? (\r\n            <div className=\"region-links\">\r\n              {data.map((regionData) => (\r\n                <Link key={regionData.region} to={`/region/${regionData.region}`} className=\"region-button\">\r\n                  {regionData.region.toUpperCase()}\r\n                </Link>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <p>Loading data...</p>\r\n          )}\r\n        </header>\r\n        <Routes>\r\n          <Route\r\n            path=\"/region/:regionId\"\r\n            element={<RegionPage data={data} />}\r\n          />\r\n        </Routes>\r\n      </div>\r\n    </Router>\r\n  );\r\n};\r\n\r\nexport default App;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,aAAa,GAAI,CAAAC,MAAM,CAAEC,KAAK,CAAEC,MAAM,CAAEC,IAAI,KAAQ,kBAAkB,CAC/E,MAAO,WAAW,CAClB,MAAO,CAAAC,UAAU,KAAM,cAAc,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAkCtC,KAAM,CAAAC,GAAa,CAAGA,CAAA,GAAM,CAC1B,KAAM,CAACC,IAAI,CAAEC,OAAO,CAAC,CAAGb,QAAQ,CAAe,EAAE,CAAC,CAClD,KAAM,CAACc,KAAK,CAAEC,QAAQ,CAAC,CAAGf,QAAQ,CAAgB,IAAI,CAAC,CAEvDD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAiB,EAAE,CAAG,GAAI,CAAAC,SAAS,CAAC,qBAAqB,CAAC,CAE/CD,EAAE,CAACE,SAAS,CAAIC,KAAK,EAAK,CACxB,GAAI,CACF,KAAM,CAAAC,YAA0B,CAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACP,IAAI,CAAC,CACzDC,OAAO,CAACO,YAAY,CAAC,CACrBL,QAAQ,CAAC,IAAI,CAAC,CAAE;AAClB,CAAE,MAAOQ,GAAG,CAAE,CACZR,QAAQ,CAAC,oDAAoD,CAAC,CAC9DS,OAAO,CAACV,KAAK,CAAC,qBAAqB,CAAES,GAAG,CAAC,CAC3C,CACF,CAAC,CAEDP,EAAE,CAACS,OAAO,CAAG,IAAM,CACjBD,OAAO,CAACE,GAAG,CAAC,6BAA6B,CAAC,CAC1CX,QAAQ,CAAC,2EAA2E,CAAC,CACvF,CAAC,CAEDC,EAAE,CAACW,OAAO,CAAG,IAAM,CACjBH,OAAO,CAACE,GAAG,CAAC,iBAAiB,CAAC,CAC9BX,QAAQ,CAAC,0EAA0E,CAAC,CACtF,CAAC,CAED,MAAO,IAAM,CACXC,EAAE,CAACY,KAAK,CAAC,CAAC,CACZ,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,mBACEpB,IAAA,CAACN,MAAM,EAAA2B,QAAA,cACLnB,KAAA,QAAKoB,SAAS,CAAC,KAAK,CAAAD,QAAA,eAClBnB,KAAA,WAAQoB,SAAS,CAAC,YAAY,CAAAD,QAAA,eAC5BrB,IAAA,OAAAqB,QAAA,CAAI,6BAA2B,CAAI,CAAC,CACnCf,KAAK,cACJN,IAAA,MAAGsB,SAAS,CAAC,eAAe,CAAAD,QAAA,CAAEf,KAAK,CAAI,CAAC,CACtCF,IAAI,CAACmB,MAAM,CAAG,CAAC,cACjBvB,IAAA,QAAKsB,SAAS,CAAC,cAAc,CAAAD,QAAA,CAC1BjB,IAAI,CAACoB,GAAG,CAAEC,UAAU,eACnBzB,IAAA,CAACH,IAAI,EAAyB6B,EAAE,CAAE,WAAWD,UAAU,CAACE,MAAM,EAAG,CAACL,SAAS,CAAC,eAAe,CAAAD,QAAA,CACxFI,UAAU,CAACE,MAAM,CAACC,WAAW,CAAC,CAAC,EADvBH,UAAU,CAACE,MAEhB,CACP,CAAC,CACC,CAAC,cAEN3B,IAAA,MAAAqB,QAAA,CAAG,iBAAe,CAAG,CACtB,EACK,CAAC,cACTrB,IAAA,CAACJ,MAAM,EAAAyB,QAAA,cACLrB,IAAA,CAACL,KAAK,EACJkC,IAAI,CAAC,mBAAmB,CACxBC,OAAO,cAAE9B,IAAA,CAACF,UAAU,EAACM,IAAI,CAAEA,IAAK,CAAE,CAAE,CACrC,CAAC,CACI,CAAC,EACN,CAAC,CACA,CAAC,CAEb,CAAC,CAED,cAAe,CAAAD,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}